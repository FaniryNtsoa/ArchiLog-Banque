<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" th:fragment="layout(title, content)">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:replace="${title}">Banque Premium</title>
    
    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí≥</text></svg>">
</head>
<body class="app-layout" th:classappend="${session.clientNom != null} ? 'authenticated' : 'guest'">
    <div class="app-container">
        <!-- Sidebar pour utilisateurs authentifi√©s -->
        <aside class="sidebar" th:if="${session.clientNom != null}">
            <div class="sidebar__header">
                <div class="sidebar__logo">
                    <span class="sidebar__logo-icon">üí≥</span>
                    <span class="sidebar__logo-text">Banque Premium</span>
                </div>
                <button class="sidebar__toggle" id="sidebarToggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            
            <div class="sidebar__user">
                <div class="sidebar__user-avatar">
                    <span th:text="${#strings.substring(session.clientPrenom, 0, 1)} + ${#strings.substring(session.clientNom, 0, 1)}">JD</span>
                </div>
                <div class="sidebar__user-info">
                    <span class="sidebar__user-name" th:text="${session.clientPrenom} + ' ' + ${session.clientNom}">John Doe</span>
                    <span class="sidebar__user-role">Client Premium</span>
                </div>
            </div>
            
            <nav class="sidebar__nav">
                <ul class="sidebar__nav-list">
                    <li class="sidebar__nav-item">
                        <a th:href="@{/dashboard}" class="sidebar__nav-link" 
                           th:classappend="${currentPage == 'dashboard'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üè†</span>
                            <span class="sidebar__nav-text">Tableau de bord</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/nouveau-compte}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'nouveau-compte'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">‚ûï</span>
                            <span class="sidebar__nav-text">Nouveau compte</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/depot}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'depot'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üìà</span>
                            <span class="sidebar__nav-text">D√©p√¥t</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/retrait}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'retrait'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üìâ</span>
                            <span class="sidebar__nav-text">Retrait</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/virement}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'virement'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üí∏</span>
                            <span class="sidebar__nav-text">Virement</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/solde}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'solde'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üí∞</span>
                            <span class="sidebar__nav-text">Consulter solde</span>
                        </a>
                    </li>
                    <li class="sidebar__nav-item">
                        <a th:href="@{/historique}" class="sidebar__nav-link"
                           th:classappend="${currentPage == 'historique'} ? 'active' : ''">
                            <span class="sidebar__nav-icon">üìã</span>
                            <span class="sidebar__nav-text">Historique</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar__nav-divider"></div>
                
                <ul class="sidebar__nav-list">
                    <li class="sidebar__nav-item">
                        <a th:href="@{/logout}" class="sidebar__nav-link sidebar__nav-link--logout">
                            <span class="sidebar__nav-icon">üö™</span>
                            <span class="sidebar__nav-text">D√©connexion</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
        
        <!-- Header pour utilisateurs non-authentifi√©s -->
        <header class="header" th:unless="${session.clientNom != null}">
            <div class="container">
                <div class="header__content">
                    <a th:href="@{/}" class="header__logo">
                        Banque Premium
                    </a>
                    
                    <nav class="header__nav">
                        <a th:href="@{/login}" class="nav-link">Connexion</a>
                        <a th:href="@{/register}" class="nav-link nav-link--active">Inscription</a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content" th:classappend="${session.clientNom != null} ? 'main-content--sidebar' : ''">
            <!-- Top Bar pour utilisateurs authentifi√©s -->
            <div class="topbar" th:if="${session.clientNom != null}">
                <button class="topbar__menu-btn" id="mobileMenuToggle" aria-label="Toggle mobile menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1 class="topbar__title" th:text="${pageTitle != null ? pageTitle : 'Tableau de bord'}">Tableau de bord</h1>
                <div class="topbar__actions">
                    <button class="topbar__notification-btn" aria-label="Notifications">
                        <span class="notification-icon">üîî</span>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
            </div>
            
            <!-- Page Content -->
            <div class="page-content" th:replace="${content}">
                <!-- Le contenu de la page sera ins√©r√© ici -->
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer th:fragment="footer" style="background: #000; color: #fff; text-align: center; padding: 2rem 0; margin-top: auto;">
        <div class="container">
            <p>&copy; 2025 Banque Premium. Tous droits r√©serv√©s.</p>
            <p class="text-muted" style="color: #999;">Application bancaire s√©curis√©e - Jakarta EE & Thymeleaf</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script th:fragment="scripts">
        // Script pour les animations fluides
        document.addEventListener('DOMContentLoaded', function() {
            // Animation d'entr√©e pour les cartes
            const cards = document.querySelectorAll('.card, .auth-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = (index * 0.1) + 's';
                card.classList.add('fade-in');
            });
            
            // Animation pour les boutons
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px) scale(1.02)';
                });
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
            
            // Auto-hide des alertes apr√®s 5 secondes
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s ease';
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        alert.remove();
                    }, 500);
                }, 5000);
            });
            
            // Gestion de la sidebar
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.querySelector('.sidebar');
            const appContainer = document.querySelector('.app-container');
            
            function toggleSidebar() {
                sidebar?.classList.toggle('sidebar--collapsed');
                appContainer?.classList.toggle('sidebar-collapsed');
            }
            
            function toggleMobileSidebar() {
                sidebar?.classList.toggle('sidebar--mobile-open');
                appContainer?.classList.toggle('mobile-sidebar-open');
            }
            
            // √âv√©nements de la sidebar
            sidebarToggle?.addEventListener('click', toggleSidebar);
            mobileMenuToggle?.addEventListener('click', toggleMobileSidebar);
            
            // Fermer la sidebar mobile en cliquant √† l'ext√©rieur
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768) {
                    const isClickInsideSidebar = sidebar?.contains(event.target);
                    const isClickOnToggle = mobileMenuToggle?.contains(event.target);
                    
                    if (!isClickInsideSidebar && !isClickOnToggle && sidebar?.classList.contains('sidebar--mobile-open')) {
                        toggleMobileSidebar();
                    }
                }
            });
            
            // Responsive: fermer la sidebar mobile lors du redimensionnement
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768 && sidebar?.classList.contains('sidebar--mobile-open')) {
                    toggleMobileSidebar();
                }
            });
            
            // Animation des liens de navigation
            const navLinks = document.querySelectorAll('.sidebar__nav-link');
            navLinks.forEach(link => {
                link.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(5px)';
                });
                link.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });
            });
        });
    </script>
</body>
</html>