<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Nouveau Compte - Administration</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
</head>
<body th:replace="~{base :: layout(~{::title}, ~{::section})}">
<section>
    <div class="page-content">
        <div class="container">

        <div class="page-header">
            <h1><i class="fas fa-plus-circle"></i> Nouveau Compte Courant</h1>
            <div class="breadcrumb">
                <span th:text="${moduleName}">Situation Bancaire</span> / 
                <span>Création de compte</span>
            </div>
        </div>

        <!-- Messages d'alerte -->
        <div th:if="${errorMessage}" class="alert alert-error">
            <i class="fas fa-exclamation-triangle"></i>
            <span th:text="${errorMessage}">Message d'erreur</span>
        </div>

        <div th:if="${successMessage}" class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <span th:text="${successMessage}">Message de succès</span>
        </div>

        <!-- Formulaire de création -->
        <div class="form-container">
            <form method="post" th:action="@{/admin/situation/nouveau-compte}" class="admin-form">
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> Sélection du client</h3>
                    
                    <div class="form-group">
                        <label for="clientId">Client propriétaire *</label>
                        <select id="clientId" name="clientId" required>
                            <option value="">-- Sélectionnez un client --</option>
                            <option th:each="client : ${clients}" 
                                    th:value="${client.idClient}" 
                                    th:text="${client.numeroClient + ' - ' + client.nomClient + ' ' + client.prenomClient}">
                                CLIENT001 - RAZAFY Jean
                            </option>
                        </select>
                        <div th:if="${!hasClients}" class="form-help error">
                            <i class="fas fa-exclamation-triangle"></i>
                            Aucun client disponible. Veuillez d'abord créer des clients.
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-cogs"></i> Configuration du compte</h3>
                    
                    <div class="form-group">
                        <label for="typeCompteId">Type de compte *</label>
                        <select id="typeCompteId" name="typeCompteId" required>
                            <option value="">-- Sélectionnez un type --</option>
                            <option th:each="typeCompte : ${typesComptes}" 
                                    th:value="${typeCompte}" 
                                    th:text="${typeCompte}">
                                Compte Courant Standard
                            </option>
                        </select>
                        <div th:if="${!hasTypesComptes}" class="form-help error">
                            <i class="fas fa-exclamation-triangle"></i>
                            Aucun type de compte disponible. Vérifiez la configuration.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="libelleCompte">Libellé du compte</label>
                        <input type="text" 
                               id="libelleCompte" 
                               name="libelleCompte" 
                               placeholder="Ex: Compte courant principal"
                               maxlength="100">
                        <div class="form-help">
                            <i class="fas fa-info-circle"></i>
                            Optionnel - Un libellé par défaut sera généré si non renseigné
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="soldeInitial">Solde initial (XOF)</label>
                        <input type="number" 
                               id="soldeInitial" 
                               name="soldeInitial" 
                               min="0" 
                               step="0.01"
                               placeholder="0.00">
                        <div class="form-help">
                            <i class="fas fa-info-circle"></i>
                            Le solde initial doit être positif ou nul
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" th:disabled="${!hasClients or !hasTypesComptes}">
                        <i class="fas fa-save"></i> Créer le compte
                    </button>
                    <a th:href="@{/admin/situation/comptes}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                </div>
            </form>
        </div>

        <!-- Informations supplémentaires -->
        <div class="info-box">
            <h4><i class="fas fa-info-circle"></i> Informations</h4>
            <ul>
                <li>Le numéro de compte sera généré automatiquement</li>
                <li>Le compte sera ouvert immédiatement après création</li>
                <li>Les paramètres du type de compte sélectionné s'appliqueront</li>
                <li>L'opération sera tracée avec votre identifiant administrateur</li>
            </ul>
        </div>
    </div>

    <script>
        // Validation côté client
        document.querySelector('.admin-form').addEventListener('submit', function(e) {
            const clientId = document.getElementById('clientId').value;
            const typeCompteId = document.getElementById('typeCompteId').value;
            
            if (!clientId) {
                alert('Veuillez sélectionner un client');
                e.preventDefault();
                return false;
            }
            
            if (!typeCompteId) {
                alert('Veuillez sélectionner un type de compte');
                e.preventDefault();
                return false;
            }
            
            const soldeInitial = parseFloat(document.getElementById('soldeInitial').value || 0);
            if (soldeInitial < 0) {
                alert('Le solde initial ne peut pas être négatif');
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
        </div>
    </div>
</section>
</body>
</html>