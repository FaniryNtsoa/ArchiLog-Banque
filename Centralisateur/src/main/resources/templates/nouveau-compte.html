<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Nouveau Compte - Banque Premium</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body th:replace="~{base :: layout(~{::title}, ~{::section})}">
<section>
    <div class="page-content">
        <div class="container-sm">
            <div class="page-header">
                <h1 class="page-title">üè¶ Cr√©er un Nouveau Compte</h1>
                <p class="page-subtitle">Ouvrez un nouveau compte courant</p>
            </div>

            <div class="card">
                <div class="card__header">
                    <h2 class="card__title">Informations du compte</h2>
                </div>
                <div class="card__content">
                    <!-- Messages d'alerte -->
                    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}">
                        Message d'erreur
                    </div>
                    
                    <form method="POST" th:action="@{/nouveau-compte}" class="form">
                        <div class="form-group">
                            <label for="libelle" class="form-label">
                                <i class="icon">üìù</i>
                                Libell√© du compte *
                            </label>
                            <input type="text" 
                                   id="libelle" 
                                   name="libelle" 
                                   class="form-input" 
                                   placeholder="Ex: Compte √©pargne, Compte vacances..."
                                   th:value="${libelle}"
                                   required
                                   maxlength="100">
                            <small class="form-help">
                                Donnez un nom √† votre nouveau compte pour l'identifier facilement
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="idTypeCompte" class="form-label">
                                <i class="icon">üè¶</i>
                                Type de compte *
                            </label>
                            <select id="idTypeCompte" 
                                    name="idTypeCompte" 
                                    class="form-input" 
                                    required
                                    onchange="updateCompteInfo(this.value)">
                                <option value="">Choisissez un type de compte</option>
                                <option th:each="typeCompte : ${typesCompte}" 
                                        th:value="${typeCompte.idTypeCompte}"
                                        th:selected="${selectedTypeCompte == typeCompte.idTypeCompte.toString()}"
                                        th:text="${typeCompte.libelle}"
                                        th:data-plafond-retrait="${typeCompte.plafondRetraitJournalier}"
                                        th:data-plafond-virement="${typeCompte.plafondVirementJournalier}"
                                        th:data-decouvert-autorise="${typeCompte.montantDecouvertAutorise}"
                                        th:data-frais-tenue="${typeCompte.fraisTenueCompte}"
                                        th:data-periodicite="${typeCompte.fraisTenueComptePeriodicite}"
                                        th:data-description="${typeCompte.description}">
                                    Type de compte
                                </option>
                            </select>
                            <small class="form-help">
                                S√©lectionnez le type de compte selon vos besoins
                            </small>
                        </div>

                        <div class="info-box" id="compteInfoBox" style="display: none;">
                            <div class="info-box__icon">‚ÑπÔ∏è</div>
                            <div class="info-box__content">
                                <h4>Caract√©ristiques du compte s√©lectionn√©</h4>
                                <div id="compteDetails">
                                    <ul>
                                        <li>Solde initial : 0,00 Ar</li>
                                        <li id="decouvertInfo">D√©couvert autoris√© : - Ar</li>
                                        <li id="plafondRetraitInfo">Plafond retrait journalier : - Ar</li>
                                        <li id="plafondVirementInfo">Plafond virement journalier : - Ar</li>
                                        <li id="fraisInfo">Frais de tenue : - Ar</li>
                                        <li>Devise : Ariary (Ar)</li>
                                        <li>Activation imm√©diate</li>
                                    </ul>
                                    <p id="descriptionInfo" class="text-muted"></p>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary">
                                <i class="btn__icon">üè¶</i>
                                Cr√©er le compte
                            </button>
                            <a th:href="@{/dashboard}" class="btn btn--secondary">
                                <i class="btn__icon">‚Ü©Ô∏è</i>
                                Retour au tableau de bord
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Avantages -->
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-card__icon">‚ö°</div>
                    <h3>Activation instantan√©e</h3>
                    <p>Votre compte sera actif imm√©diatement apr√®s cr√©ation</p>
                </div>
                <div class="feature-card">
                    <div class="feature-card__icon">üí≥</div>
                    <h3>D√©couvert inclus</h3>
                    <p>300‚Ç¨ de d√©couvert autoris√© d√®s l'ouverture</p>
                </div>
                <div class="feature-card">
                    <div class="feature-card__icon">üîí</div>
                    <h3>S√©curit√© maximale</h3>
                    <p>Protection avanc√©e de vos donn√©es et transactions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Script JavaScript pour mettre √† jour les informations du compte -->
    <script>
        function updateCompteInfo(typeCompteId) {
            const infoBox = document.getElementById('compteInfoBox');
            const select = document.getElementById('idTypeCompte');
            
            if (!typeCompteId) {
                infoBox.style.display = 'none';
                return;
            }
            
            const selectedOption = select.querySelector(`option[value="${typeCompteId}"]`);
            if (!selectedOption) {
                infoBox.style.display = 'none';
                return;
            }
            
            // R√©cup√©rer les donn√©es du type de compte s√©lectionn√©
            const plafondRetrait = selectedOption.dataset.plafondRetrait || '0';
            const plafondVirement = selectedOption.dataset.plafondVirement || '0';
            const decouvertAutorise = selectedOption.dataset.decouvertAutorise || '0';
            const fraisTenue = selectedOption.dataset.fraisTenue || '0';
            const periodicite = selectedOption.dataset.periodicite || 'MENSUEL';
            const description = selectedOption.dataset.description || '';
            
            // Formater les nombres
            const formatNumber = (num) => {
                return new Intl.NumberFormat('fr-FR').format(parseFloat(num));
            };
            
            // Mettre √† jour les informations affich√©es
            document.getElementById('decouvertInfo').textContent = 
                `D√©couvert autoris√© : ${formatNumber(decouvertAutorise)} Ar`;
            document.getElementById('plafondRetraitInfo').textContent = 
                `Plafond retrait journalier : ${formatNumber(plafondRetrait)} Ar`;
            document.getElementById('plafondVirementInfo').textContent = 
                `Plafond virement journalier : ${formatNumber(plafondVirement)} Ar`;
            document.getElementById('fraisInfo').textContent = 
                `Frais de tenue : ${formatNumber(fraisTenue)} Ar (${periodicite.toLowerCase()})`;
            document.getElementById('descriptionInfo').textContent = description;
            
            // Afficher la bo√Æte d'information
            infoBox.style.display = 'block';
        }
        
        // Initialiser l'affichage si un type est d√©j√† s√©lectionn√©
        document.addEventListener('DOMContentLoaded', function() {
            const select = document.getElementById('idTypeCompte');
            if (select.value) {
                updateCompteInfo(select.value);
            }
        });
    </script>
</section>
</body>
</html>