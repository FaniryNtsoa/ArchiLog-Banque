<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Mes PrÃªts - Banque Premium</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body th:replace="~{base :: layout(~{::title}, ~{::section})}">
<section>
    <div class="container">
        <!-- Messages -->
        <div th:if="${session.successMessage != null}" class="alert alert-success">
            <span th:text="${session.successMessage}">Message de succÃ¨s</span>
        </div>
        
        <div th:if="${errorMessage != null}" class="alert alert-danger">
            <span th:text="${errorMessage}">Message d'erreur</span>
        </div>

        <!-- En-tÃªte -->
        <div class="page-header">
            <h1 class="page-title">ğŸ“Š Mes PrÃªts</h1>
            <p class="page-subtitle">
                Consultez l'Ã©tat de vos demandes de prÃªts et gÃ©rez vos remboursements
            </p>
        </div>

            <!-- Liste des prÃªts -->
            <div th:if="${hasPrets == true}">
                <div th:each="pret : ${prets}" class="card mb-3">
                    <div class="card__header">
                        <h2 class="card__title">
                            <span th:text="${pret.numeroPret}">NÂ° PRE-2025-0001</span>
                            <span class="badge" 
                                  th:classappend="${pret.statut == 'EN_ATTENTE'} ? 'badge-warning' : (${pret.statut == 'APPROUVE' or pret.statut == 'EN_COURS'} ? 'badge-success' : (${pret.statut == 'REFUSE'} ? 'badge-danger' : 'badge-secondary'))"
                                  th:text="${pret.statut == 'EN_ATTENTE'} ? 'En attente' : (${pret.statut == 'APPROUVE'} ? 'ApprouvÃ©' : (${pret.statut == 'EN_COURS'} ? 'En cours' : (${pret.statut == 'REFUSE'} ? 'RefusÃ©' : (${pret.statut == 'CLOTURE'} ? 'ClÃ´turÃ©' : pret.statut))))">
                                En attente
                            </span>
                        </h2>
                    </div>
                    <div class="card__content">
                        <div class="pret-details">
                            <!-- Informations principales -->
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Type de prÃªt:</span>
                                    <span class="detail-value" th:text="${pret.libelleTypePret}">PrÃªt Personnel</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Montant:</span>
                                    <span class="detail-value" th:text="${#numbers.formatCurrency(pret.montantAccorde != null ? pret.montantAccorde : pret.montantDemande)}">50 000,00 â‚¬</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">DurÃ©e:</span>
                                    <span class="detail-value" th:text="${pret.dureeMois} + ' mois'">120 mois</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Taux annuel:</span>
                                    <span class="detail-value" th:text="${pret.tauxInteretAnnuel} + ' %'">5.5 %</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">MensualitÃ©:</span>
                                    <span class="detail-value text-gold" th:text="${pret.mensualite != null ? #numbers.formatCurrency(pret.mensualite) : 'N/A'}">542,50 â‚¬</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Date de demande:</span>
                                    <span class="detail-value" th:text="${#temporals.format(pret.dateDemande, 'dd/MM/yyyy')}">15/01/2025</span>
                                </div>
                            </div>

                            <!-- Informations supplÃ©mentaires pour prÃªt approuvÃ© -->
                            <div th:if="${pret.statut == 'APPROUVE'}" class="mt-3">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Date dÃ©but remboursement:</span>
                                        <span class="detail-value" th:text="${#temporals.format(pret.dateDebutRemboursement, 'dd/MM/yyyy')}">01/02/2025</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Capital restant:</span>
                                        <span class="detail-value" th:text="${pret.capitalRestant != null ? #numbers.formatCurrency(pret.capitalRestant) : 'N/A'}">48 500,00 â‚¬</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Montant total remboursÃ©:</span>
                                        <span class="detail-value" th:text="${pret.montantTotalRembourse != null ? #numbers.formatCurrency(pret.montantTotalRembourse) : '0,00 â‚¬'}">1 500,00 â‚¬</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Motif (si prÃ©sent) -->
                            <!-- <div th:if="${pret.motif != null}" class="mt-3">
                                <div class="detail-item">
                                    <span class="detail-label">Motif:</span>
                                    <span class="detail-value" th:text="${pret.motif}">Achat immobilier</span>
                                </div>
                            </div> -->

                            <!-- Motif de refus (si refusÃ©) -->
                            <div th:if="${pret.statut == 'REFUSE' and pret.motifRefus != null}" class="mt-3">
                                <div class="alert alert-danger">
                                    <strong>Motif du refus:</strong>
                                    <span th:text="${pret.motifRefus}">CapacitÃ© d'endettement insuffisante</span>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="form-actions mt-3">
                                <a th:if="${pret.statut == 'APPROUVE'}" 
                                   th:href="@{/pret/remboursement(idPret=${pret.idPret})}" 
                                   class="btn btn-gold">
                                    ğŸ’³ Effectuer un remboursement
                                </a>
                                <a th:if="${pret.statut == 'EN_ATTENTE'}" 
                                   href="#" 
                                   class="btn btn-outline disabled" style="cursor: not-allowed;">
                                    â³ En attente d'approbation
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message si aucun prÃªt -->
            <div th:unless="${hasPrets == true}" class="card">
                <div class="card__content text-center" style="padding: 3rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“‹</div>
                    <h3>Aucun prÃªt trouvÃ©</h3>
                    <p class="text-muted">Vous n'avez pas encore de demande de prÃªt.</p>
                    <div class="form-actions mt-3">
                        <a th:href="@{/pret/simulation}" class="btn btn-gold">
                            ğŸ§® Faire une simulation
                        </a>
                        <a th:href="@{/pret/demande}" class="btn btn-outline">
                            ğŸ“ Faire une demande
                        </a>
                    </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>