<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Mes Pr√™ts - Banque Premium</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body th:replace="~{base :: layout(~{::title}, ~{::section})}">
<section>
    <div class="container">
        <!-- Messages -->
        <div th:if="${session.successMessage != null}" class="alert alert-success">
            <span th:text="${session.successMessage}">Message de succ√®s</span>
        </div>
        
        <div th:if="${errorMessage != null}" class="alert alert-danger">
            <span th:text="${errorMessage}">Message d'erreur</span>
        </div>

        <!-- En-t√™te -->
        <div class="page-header">
            <h1 class="page-title">üìä Mes Pr√™ts</h1>
            <p class="page-subtitle">
                Consultez l'√©tat de vos demandes de pr√™ts et g√©rez vos remboursements
            </p>
        </div>

            <!-- Liste des pr√™ts -->
            <div th:if="${hasPrets == true}">
                <div th:each="pret : ${prets}" class="card mb-3">
                    <div class="card__header">
                        <h2 class="card__title">
                            <span th:text="${pret.numeroPret}">N¬∞ PRE-2025-0001</span>
                            <span class="badge" 
                                  th:classappend="${pret.statut == 'EN_ATTENTE'} ? 'badge-warning' : (${pret.statut == 'APPROUVE' or pret.statut == 'EN_COURS'} ? 'badge-success' : (${pret.statut == 'REFUSE'} ? 'badge-danger' : 'badge-secondary'))"
                                  th:text="${pret.statut == 'EN_ATTENTE'} ? 'En attente' : (${pret.statut == 'APPROUVE'} ? 'Approuv√©' : (${pret.statut == 'EN_COURS'} ? 'En cours' : (${pret.statut == 'REFUSE'} ? 'Refus√©' : (${pret.statut == 'CLOTURE'} ? 'Cl√¥tur√©' : pret.statut))))">
                                En attente
                            </span>
                        </h2>
                    </div>
                    <div class="card__content">
                        <div class="pret-details">
                            <!-- Informations principales -->
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Type de pr√™t:</span>
                                    <span class="detail-value" th:text="${pret.libelleTypePret}">Pr√™t Personnel</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Montant:</span>
                                    <span class="detail-value" th:text="${#numbers.formatCurrency(pret.montantAccorde != null ? pret.montantAccorde : pret.montantDemande)}">50 000,00 ‚Ç¨</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Dur√©e:</span>
                                    <span class="detail-value" th:text="${pret.dureeMois} + ' mois'">120 mois</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Taux annuel:</span>
                                    <span class="detail-value" th:text="${pret.tauxInteretAnnuel} + ' %'">5.5 %</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Mensualit√©:</span>
                                    <span class="detail-value text-gold" th:text="${pret.mensualite != null ? #numbers.formatCurrency(pret.mensualite) : 'N/A'}">542,50 ‚Ç¨</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Date de demande:</span>
                                    <span class="detail-value" th:text="${#temporals.format(pret.dateDemande, 'dd/MM/yyyy')}">15/01/2025</span>
                                </div>
                            </div>

                            <!-- Informations suppl√©mentaires pour pr√™t approuv√© -->
                            <div th:if="${pret.statut == 'APPROUVE'}" class="mt-3">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Premi√®re √©ch√©ance:</span>
                                        <span class="detail-value" th:text="${pret.datePremiereEcheance != null ? #temporals.format(pret.datePremiereEcheance, 'dd/MM/yyyy') : 'N/A'}">01/02/2025</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Montant total d√ª:</span>
                                        <span class="detail-value" th:text="${pret.montantTotalDu != null ? #numbers.formatCurrency(pret.montantTotalDu) : 'N/A'}">65 100,00 ‚Ç¨</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">P√©nalit√©s totales:</span>
                                        <span class="detail-value" th:text="${pret.totalPenalites != null ? #numbers.formatCurrency(pret.totalPenalites) : '0,00 ‚Ç¨'}">0,00 ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Motif (si pr√©sent) -->
                            <!-- <div th:if="${pret.motif != null}" class="mt-3">
                                <div class="detail-item">
                                    <span class="detail-label">Motif:</span>
                                    <span class="detail-value" th:text="${pret.motif}">Achat immobilier</span>
                                </div>
                            </div> -->

                            <!-- Motif de refus (si refus√©) -->
                            <div th:if="${pret.statut == 'REFUSE' and pret.motifRefus != null}" class="mt-3">
                                <div class="alert alert-danger">
                                    <strong>Motif du refus:</strong>
                                    <span th:text="${pret.motifRefus}">Capacit√© d'endettement insuffisante</span>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="form-actions mt-3">
                                <!-- Bouton Voir d√©tails pour les pr√™ts EN_COURS, EN_RETARD ou CLOTURE -->
                                <a th:if="${pret.statut == 'EN_COURS' or pret.statut == 'EN_RETARD' or pret.statut == 'CLOTURE'}" 
                                   th:href="@{/pret/detail(idPret=${pret.idPret})}" 
                                   class="btn btn-outline">
                                    üìä Voir tableau d'amortissement
                                </a>
                                
                                <!-- Bouton Remboursement pour les pr√™ts EN_COURS ou EN_RETARD -->
                                <a th:if="${pret.statut == 'EN_COURS' or pret.statut == 'EN_RETARD'}" 
                                   th:href="@{/pret/remboursement(idPret=${pret.idPret})}" 
                                   class="btn btn-gold">
                                    üí≥ Effectuer un remboursement
                                </a>
                                
                                <!-- Message pour pr√™ts EN_ATTENTE -->
                                <a th:if="${pret.statut == 'EN_ATTENTE'}" 
                                   href="#" 
                                   class="btn btn-outline disabled" style="cursor: not-allowed;">
                                    ‚è≥ En attente d'approbation
                                </a>
                                
                                <!-- Message pour pr√™ts APPROUVE (juste approuv√©s mais pas encore EN_COURS) -->
                                <a th:if="${pret.statut == 'APPROUVE'}" 
                                   th:href="@{/pret/detail(idPret=${pret.idPret})}" 
                                   class="btn btn-success">
                                    ‚úÖ Pr√™t approuv√© - Voir d√©tails
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message si aucun pr√™t -->
            <div th:unless="${hasPrets == true}" class="card">
                <div class="card__content text-center" style="padding: 3rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üìã</div>
                    <h3>Aucun pr√™t trouv√©</h3>
                    <p class="text-muted">Vous n'avez pas encore de demande de pr√™t.</p>
                    <div class="form-actions mt-3">
                        <a th:href="@{/pret/simulation}" class="btn btn-gold">
                            üßÆ Faire une simulation
                        </a>
                        <a th:href="@{/pret/demande}" class="btn btn-outline">
                            üìù Faire une demande
                        </a>
                    </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>