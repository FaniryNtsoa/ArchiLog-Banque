<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base :: layout(~{::title}, ~{::section})}">
<head>
    <title th:text="${pageTitle}">D√©tail du Pr√™t - Banque Premium</title>
</head>
<body>
<section>
    <div class="container">
        <!-- Messages -->
        <div th:if="${successMessage != null}" class="alert alert-success">
            <span th:text="${successMessage}">Message de succ√®s</span>
        </div>
        
        <div th:if="${errorMessage != null}" class="alert alert-danger">
            <span th:text="${errorMessage}">Message d'erreur</span>
        </div>

        <!-- En-t√™te avec retour -->
        <div class="page-header">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a th:href="@{/pret/mes-prets}" class="btn btn-outline" style="padding: 0.5rem 1rem;">
                    ‚Üê Retour
                </a>
                <div>
                    <h1 class="page-title">üìä D√©tail du Pr√™t</h1>
                    <p class="page-subtitle">Tableau d'amortissement et suivi des paiements</p>
                </div>
            </div>
        </div>

        <!-- Informations du pr√™t -->
        <div th:if="${pret != null}" class="card mb-4">
            <div class="card__header">
                <h2 class="card__title">
                    <span th:text="${pret.numeroPret}">N¬∞ PRET123456</span>
                    <span class="badge" 
                          th:classappend="${pret.statut == 'EN_COURS'} ? 'badge-success' : (${pret.statut == 'EN_RETARD'} ? 'badge-danger' : (${pret.statut == 'CLOTURE'} ? 'badge-secondary' : 'badge-warning'))"
                          th:text="${pret.statut == 'EN_COURS'} ? 'En cours' : (${pret.statut == 'EN_RETARD'} ? 'En retard' : (${pret.statut == 'CLOTURE'} ? 'Cl√¥tur√©' : pret.statut))">
                        En cours
                    </span>
                </h2>
            </div>
            <div class="card__content">
                <div class="details-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    <div class="detail-item">
                        <span class="detail-label">Type de pr√™t:</span>
                        <span class="detail-value" th:text="${pret.libelleTypePret}">Pr√™t Personnel</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Montant accord√©:</span>
                        <span class="detail-value text-gold" th:text="${#numbers.formatCurrency(pret.montantAccorde != null ? pret.montantAccorde : pret.montantDemande)}">50 000,00 ‚Ç¨</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Taux annuel:</span>
                        <span class="detail-value" th:text="${pret.tauxInteretAnnuel} + ' %'">5.5 %</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Dur√©e:</span>
                        <span class="detail-value" th:text="${pret.dureeMois} + ' mois'">120 mois</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Mensualit√©:</span>
                        <span class="detail-value text-gold" th:text="${#numbers.formatCurrency(pret.mensualite)}">542,50 ‚Ç¨</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Montant total d√ª:</span>
                        <span class="detail-value" th:text="${pret.montantTotalDu != null ? #numbers.formatCurrency(pret.montantTotalDu) : 'N/A'}">65 100,00 ‚Ç¨</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Date approbation:</span>
                        <span class="detail-value" th:text="${pret.dateApprobation != null ? #temporals.format(pret.dateApprobation, 'dd/MM/yyyy') : 'N/A'}">15/01/2025</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Premi√®re √©ch√©ance:</span>
                        <span class="detail-value" th:text="${pret.datePremiereEcheance != null ? #temporals.format(pret.datePremiereEcheance, 'dd/MM/yyyy') : 'N/A'}">01/02/2025</span>
                    </div>
                </div>

                <!-- Barre de progression -->
                <div class="mt-4">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 500;">Progression des paiements</span>
                        <span th:text="${progressionPaiement} + '%'">50%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar__fill" th:style="'width: ' + ${progressionPaiement} + '%'"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.875rem; color: #666;">
                        <span th:text="${nombreEcheancesPayees} + ' √©ch√©ance(s) pay√©e(s)'">5 √©ch√©ances pay√©es</span>
                        <span th:text="${nombreEcheancesTotales - nombreEcheancesPayees} + ' √©ch√©ance(s) restante(s)'">55 √©ch√©ances restantes</span>
                    </div>
                </div>

                <!-- Statistiques -->
                <div class="details-grid mt-4" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="detail-item">
                        <span class="detail-label">Total √©ch√©ances:</span>
                        <span class="detail-value" th:text="${nombreEcheancesTotales}">120</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">√âch√©ances pay√©es:</span>
                        <span class="detail-value text-success" th:text="${nombreEcheancesPayees}">5</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">√âch√©ances en retard:</span>
                        <span class="detail-value text-danger" th:text="${nombreEcheancesEnRetard}">0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Total p√©nalit√©s:</span>
                        <span class="detail-value text-danger" th:text="${#numbers.formatCurrency(totalPenalites)}">0,00 ‚Ç¨</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions mt-4">
                    <a th:href="@{/pret/remboursement(idPret=${pret.idPret})}" class="btn btn-gold">
                        üí≥ Effectuer un remboursement
                    </a>
                </div>
            </div>
        </div>

        <!-- Tableau d'amortissement -->
        <div th:if="${tableauAmortissement != null and !tableauAmortissement.isEmpty()}" class="card">
            <div class="card__header">
                <h2 class="card__title">üìÖ Tableau d'Amortissement</h2>
            </div>
            <div class="card__content">
                <div class="table-responsive">
                    <table class="table-amortissement">
                        <thead>
                            <tr>
                                <th>N¬∞</th>
                                <th>Date √©ch√©ance</th>
                                <th>Capital</th>
                                <th>Int√©r√™ts</th>
                                <th>Mensualit√©</th>
                                <th>Capital restant</th>
                                <th>Statut</th>
                                <th>P√©nalit√©s</th>
                                <th>Date paiement</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="echeance : ${tableauAmortissement}"
                                th:classappend="${echeance.statut == 'PAYE'} ? 'row-paid' : (${echeance.statut == 'EN_RETARD'} ? 'row-late' : '')">
                                <td th:text="${echeance.numeroEcheance}">#1</td>
                                <td th:text="${#temporals.format(echeance.dateEcheance, 'dd/MM/yyyy')}">01/02/2025</td>
                                <td th:text="${#numbers.formatCurrency(echeance.capital)}">400,00 ‚Ç¨</td>
                                <td th:text="${#numbers.formatCurrency(echeance.interet)}">142,50 ‚Ç¨</td>
                                <td th:text="${#numbers.formatCurrency(echeance.montantEcheance)}">542,50 ‚Ç¨</td>
                                <td th:text="${#numbers.formatCurrency(echeance.capitalRestant)}">49 600,00 ‚Ç¨</td>
                                <td>
                                    <span class="badge badge-sm" 
                                          th:classappend="${echeance.statut == 'PAYE'} ? 'badge-success' : (${echeance.statut == 'EN_RETARD'} ? 'badge-danger' : (${echeance.statut == 'A_VENIR'} ? 'badge-secondary' : 'badge-warning'))"
                                          th:text="${echeance.statut == 'PAYE'} ? 'Pay√©' : (${echeance.statut == 'EN_RETARD'} ? 'En retard' : (${echeance.statut == 'A_VENIR'} ? '√Ä venir' : echeance.statut))">
                                        Pay√©
                                    </span>
                                </td>
                                <td th:text="${echeance.penaliteAppliquee != null ? #numbers.formatCurrency(echeance.penaliteAppliquee) : '-'}">-</td>
                                <td th:text="${echeance.datePaiement != null ? #temporals.format(echeance.datePaiement, 'dd/MM/yyyy') : '-'}">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div th:if="${tableauAmortissement == null or tableauAmortissement.isEmpty()}" class="card">
            <div class="card__content text-center">
                <p class="text-muted">üìã Aucune √©ch√©ance g√©n√©r√©e pour ce pr√™t.</p>
            </div>
        </div>
    </div>
</section>
</body>
</html>
